# 要件書

## はじめに

現在のマンデルブロ集合ビジュアライザーにマウスによる拡縮・パン機能を追加し、フラクタルの探索をより直感的で使いやすくします。この機能により、ユーザーは興味深い領域を簡単にズームインして詳細を確認したり、異なる領域を探索したりできるようになります。

## 要件

### 要件1: マウスホイールによるズーム機能

**ユーザーストーリー:** フラクタル探索者として、マウスホイールを使って興味のある領域を拡大・縮小したいので、詳細なフラクタルパターンを効率的に探索できる

#### 受け入れ基準

1. WHEN ユーザーがマウスホイールを上に回転させる THEN システムは マウスカーソル位置を中心にズームインする
2. WHEN ユーザーがマウスホイールを下に回転させる THEN システムは マウスカーソル位置を中心にズームアウトする
3. WHEN ズーム操作が実行される THEN システムは 新しい複素平面範囲で画像を再生成する
4. WHEN ズーム倍率が最小値（0.1倍）に達する THEN システムは それ以上のズームアウトを制限する
5. WHEN ズーム倍率が最大値（100倍）に達する THEN システムは それ以上のズームインを制限する

### 要件2: マウスドラッグによるパン機能

**ユーザーストーリー:** フラクタル探索者として、マウスドラッグで表示領域を移動したいので、現在のズームレベルを維持しながら異なる領域を探索できる

#### 受け入れ基準

1. WHEN ユーザーが左マウスボタンを押下してドラッグを開始する THEN システムは パンモードに入りマウスカーソルを掴み手に変更する
2. WHEN ユーザーがマウスをドラッグしている THEN システムは ドラッグ方向に表示領域をリアルタイムで移動する
3. WHEN ユーザーが左マウスボタンを離す THEN システムは パンモードを終了し新しい複素平面範囲で画像を再生成する
4. WHEN パン操作が実行される THEN システムは 現在のズーム倍率を維持する
5. WHEN パン操作中にマウスカーソルがウィジェット外に出る THEN システムは パン操作を継続する

### 要件3: 座標変換とリアルタイム更新

**ユーザーストーリー:** フラクタル探索者として、マウス操作に対してスムーズで応答性の高いフィードバックを得たいので、快適な探索体験ができる

#### 受け入れ基準

1. WHEN マウス操作が実行される THEN システムは ピクセル座標を複素平面座標に正確に変換する
2. WHEN ズーム・パン操作中 THEN システムは 既存の画像を変形して即座に視覚的フィードバックを提供する
3. WHEN 操作が完了する THEN システムは 100ms以内に新しい範囲での画像再生成を開始する
4. WHEN 画像再生成中 THEN システムは 現在のズーム倍率を画面に表示する
5. WHEN 連続的な操作が行われる THEN システムは 最後の操作から100ms後に画像再生成を実行する

### 要件4: 表示リセット機能

**ユーザーストーリー:** フラクタル探索者として、表示を初期状態に戻したいので、探索中に迷子になった時に簡単に元の表示に戻れる

#### 受け入れ基準

1. WHEN ユーザーが画像領域をダブルクリックする THEN システムは ズーム倍率を1.0に、パンオフセットを0にリセットする
2. WHEN リセット操作が実行される THEN システムは 初期の複素平面範囲（config.jsonで定義）で画像を再生成する
3. WHEN リセット操作が実行される THEN システムは ステータスバーに「表示をリセットしました」メッセージを表示する

### 要件5: 設定可能なパラメータ

**ユーザーストーリー:** システム管理者として、ズーム・パン操作の感度や制限を設定したいので、異なるユーザーの好みや性能要件に対応できる

#### 受け入れ基準

1. WHEN config.jsonにズーム感度設定が存在する THEN システムは その値を使用してズーム操作の感度を調整する
2. WHEN config.jsonにズーム制限設定が存在する THEN システムは その値を使用して最小・最大ズーム倍率を制限する
3. WHEN config.jsonに更新遅延設定が存在する THEN システムは その値を使用して画像再生成の遅延時間を調整する
4. IF 設定ファイルに値が存在しない THEN システムは デフォルト値（感度0.1、最小0.1倍、最大100倍、遅延100ms）を使用する

### 要件6: エラーハンドリングと安全性

**ユーザーストーリー:** フラクタル探索者として、マウス操作中にエラーが発生しても安全に動作を継続したいので、安定した探索体験ができる

#### 受け入れ基準

1. WHEN 座標変換でエラーが発生する THEN システムは エラーをログに記録し操作を無視する
2. WHEN 画像再生成でエラーが発生する THEN システムは エラーメッセージをステータスバーに表示し前の画像を保持する
3. WHEN 無効なズーム・パン値が計算される THEN システムは 値を有効範囲内にクランプする
4. WHEN メモリ不足が発生する THEN システムは 低解像度モードに自動切り替えして動作を継続する